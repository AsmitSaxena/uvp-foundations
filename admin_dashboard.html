<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP - Admin Dashboard</title>
    <link rel="stylesheet" href="erp.css">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, updateDoc, addDoc, deleteDoc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, signOut, deleteUser } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-functions.js";
        import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCH2BYhLITb-RrzosdVmJfl7H1TUyqG_To",
            authDomain: "uvp-foundation-e5ece.firebaseapp.com",
            projectId: "uvp-foundation-e5ece",
            storageBucket: "uvp-foundation-e5ece.appspot.com",
            messagingSenderId: "501646281843",
            appId: "1:501646281843:web:6fe9ecff026df0c671ee06"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const functions = getFunctions(app);
        const storage = getStorage(app);

        let startups = [];
        let adminsAndMentors = [];
        const growthPoints = [
            "Startup Idea Validation, Market surveys",
            "Business Model Canvas",
            "Legal compliances and Secretarial Services",
            "PoC, Prototyping, testing and MVP Development",
            "Government grants and Angel funding",
            "Marketing Planning",
            "Product and service development",
            "Go to Market -Strategy development and Implementation",
            "Branding and Promotion",
            "Funding and Investment",
            "Systems and structures development",
            "Scaling Up"
        ];
        const levels = [
            "Ideation Stage",
            "PoC/Prototype",
            "Business Plan/Model",
            "Pitch Ready",
            "Team Building",
            "Funding/Investment Stage"
        ];

        // Format date to a more readable format
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            
            try {
                const date = new Date(dateString);
                return new Intl.DateTimeFormat('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }).format(date);
            } catch (e) {
                return dateString;
            }
        }

        const mainSection = document.getElementById("mainSection");

        // Load admins and mentors
        async function loadAdminsAndMentors() {
            try {
                // Show loading indicator
                mainSection.innerHTML = '<div class="loading">Loading admins and mentors data...</div>';
                
                const collectionRef = collection(db, 'adminsAndMentors');
                const snapshot = await getDocs(collectionRef);
                
                if (snapshot.empty) {
                    mainSection.innerHTML = `
                        <h2>Admins and Mentors</h2>
                        <div class="empty-section">No admins or mentors found in the database. Click "Add Team Member" to add new team members.</div>
                        <button id="addMentorBtn" style="margin-top: 20px;">Add Team Member</button>
                    `;
                    document.getElementById("addMentorBtn").addEventListener("click", renderAddMentorForm);
                    return;
                }
                
                adminsAndMentors = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                renderAdminsAndMentors();
            } catch (error) {
                console.error("Error loading admins and mentors: ", error);
                mainSection.innerHTML = `
                    <h2>Admins and Mentors</h2>
                    <div class="error-message">Error loading admins and mentors: ${error.message}</div>
                    <button id="retryBtn" style="margin-top: 20px;">Retry</button>
                `;
                document.getElementById("retryBtn").addEventListener("click", loadAdminsAndMentors);
            }
        }

        // Render admins and mentors
        function renderAdminsAndMentors() {
            // Filter admins and mentors based on their roles
            const admins = adminsAndMentors.filter(person => person.role && person.role.toLowerCase().includes('admin'));
            const mentors = adminsAndMentors.filter(person => person.role && person.role.toLowerCase().includes('mentor'));
            
            mainSection.innerHTML = `
                <h2>Admins and Mentors</h2>
                <style>
                    .section-title {
                        margin: 20px 0px 10px;
                        padding-bottom: 10px;
                        border-bottom: 2px solid #5390bf;
                        font-size: 1.5rem;
                        color: #333;
                    }
                    .loading {
                        padding: 20px;
                        text-align: center;
                        font-size: 1.2rem;
                        color: #666;
                        background-color: #f9f9f9;
                        border-radius: 5px;
                        margin: 20px 0;
                    }
                    .error-message {
                        padding: 15px;
                        text-align: center;
                        color: #721c24;
                        background-color: #f8d7da;
                        border: 1px solid #f5c6cb;
                        border-radius: 5px;
                        margin: 20px 0;
                    }
                    .admin-card {
                        text-align: center;
                        padding: 1.5rem;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        position: relative;
                    }
                    .admin-card:after {
                        content: '';
                        position: absolute;
                        top: 0;
                        right: 10px;
                        background-color: #5390bf;
                        color: white;
                        padding: 5px 10px;
                        border-radius: 0 0 5px 5px;
                        font-size: 0.7rem;
                        font-weight: bold;
                        text-transform: uppercase;
                    }
                    .admin-card.admin-type:after {
                        content: 'Admin';
                        background-color: #4a6da7;
                    }
                    .admin-card.mentor-type:after {
                        content: 'Mentor';
                        background-color: #28a745;
                    }
                    .admin-card h4 {
                        margin-bottom: 0.5rem;
                        font-size: 1.2rem;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    .admin-card p {
                        margin-bottom: 1rem;
                        color: #666;
                    }
                    .admin-actions {
                        display: flex;
                        gap: 10px;
                        margin-top: 0.5rem;
                    }
                    .admin-actions button {
                        padding: 0.5rem 1rem;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: background-color 0.3s;
                    }
                    .details-btn {
                        background-color: #5390bf;
                        color: white;
                    }
                    .details-btn:hover {
                        background-color: #4682B4;
                    }
                    .remove-btn {
                        background-color: #d9534f;
                        color: white;
                    }
                    .remove-btn:hover {
                        background-color: #c9302c;
                    }
                    .section-container {
                        margin-bottom: 30px;
                    }
                    .empty-section {
                        padding: 15px;
                        text-align: center;
                        color: #666;
                        font-style: italic;
                        background-color: #f9f9f9;
                        border-radius: 5px;
                    }
                </style>
                
                <div class="section-container">
                    <h3 class="section-title">Admins</h3>
                    <div class="container">
                        ${admins.length ? admins.map(
                            person => `
                            <div class="card admin-card admin-type">
                                <h4>${person.name}</h4>
                                <p>${person.designation}</p>
                                <div class="admin-actions">
                                    <button class="details-btn" data-id="${person.id}">Details</button>
                                    <button class="remove-btn" data-id="${person.id}">Remove</button>
                                </div>
                            </div>`).join("") : 
                            '<div class="empty-section">No administrators found</div>'}
                    </div>
                </div>
                
                <div class="section-container">
                    <h3 class="section-title">Mentors</h3>
                    <div class="container">
                        ${mentors.length ? mentors.map(
                            person => `
                            <div class="card admin-card mentor-type">
                                <h4>${person.name}</h4>
                                <p>${person.designation}</p>
                                <div class="admin-actions">
                                    <button class="details-btn" data-id="${person.id}">Details</button>
                                    <button class="remove-btn" data-id="${person.id}">Remove</button>
                                </div>
                            </div>`).join("") : 
                            '<div class="empty-section">No mentors found</div>'}
                    </div>
                </div>
                
                <div class="section-container">
                    <h3 class="section-title">Other Team Members</h3>
                    <div class="container">
                        ${adminsAndMentors.filter(person => 
                            !admins.includes(person) && !mentors.includes(person)
                        ).length ? 
                        adminsAndMentors.filter(person => 
                            !admins.includes(person) && !mentors.includes(person)
                        ).map(person => `
                            <div class="card admin-card">
                                <h4>${person.name}</h4>
                                <p>${person.designation}</p>
                                <div class="admin-actions">
                                    <button class="details-btn" data-id="${person.id}">Details</button>
                                    <button class="remove-btn" data-id="${person.id}">Remove</button>
                                </div>
                            </div>`).join("") : 
                            '<div class="empty-section">No other team members found</div>'}
                    </div>
                </div>
                
                <button id="addMentorBtn">Add Team Member</button>
            `;

            document.querySelectorAll(".remove-btn").forEach(button => {
                button.addEventListener("click", event => {
                    const personId = event.target.getAttribute("data-id");
                    removeAdminOrMentor(personId);
                });
            });

            document.querySelectorAll(".details-btn").forEach(button => {
                button.addEventListener("click", event => {
                    const personId = event.target.getAttribute("data-id");
                    viewAdminMentorDetails(personId);
                });
            });

            document.getElementById("addMentorBtn").addEventListener("click", renderAddMentorForm);
        }
        
        // View details of an admin or mentor
        function viewAdminMentorDetails(personId) {
            const person = adminsAndMentors.find(p => p.id === personId);
            if (person) {
                const acceptedTasks = person.accepted || [];
                const completedTasks = person.completed || [];

                const acceptedNames = acceptedTasks.map(taskId => {
                    const startup = startups.find(s => s.id === taskId);
                    return startup ? startup.organizationName : "Unknown";
                });

                const completedNames = completedTasks.map(taskId => {
                    const startup = startups.find(s => s.id === taskId);
                    return startup ? startup.organizationName : "Unknown";
                });

                // Set color class based on role
                let roleColorClass = '';
                if (person.role && person.role.toLowerCase().includes('admin')) {
                    roleColorClass = 'admin-role';
                } else if (person.role && person.role.toLowerCase().includes('mentor')) {
                    roleColorClass = 'mentor-role';
                }

                mainSection.innerHTML = `
                    <h2>${person.name}'s Details</h2>
                    <div class="container vertical-stack">
                        <div class="card">
                            <h3>Profile</h3>
                            <div class="role-badge ${roleColorClass}">${person.role || "Team Member"}</div>
                            <br>
                            <p><strong>Phone:</strong> ${person.phone || "N/A"}</p><br>
                            <p><strong>Email:</strong> ${person.email || "N/A"}</p><br>
                            <p><strong>Designation:</strong> ${person.designation || "N/A"}</p><br>
                        </div>
                        <div class="card">
                            <h3>Accepted Tasks</h3>
                            ${acceptedNames.length > 0 ? 
                                `<ul>
                                    ${acceptedNames.map(name => `<li>${name}</li>`).join("")}
                                </ul>` : 
                                `<p>No accepted tasks</p>`
                            }
                        </div>
                        <div class="card">
                            <h3>Completed Tasks</h3>
                            ${completedNames.length > 0 ? 
                                `<ul>
                                    ${completedNames.map(name => `<li>${name}</li>`).join("")}
                                </ul>` : 
                                `<p>No completed tasks</p>`
                            }
                        </div>
                    </div>
                    <style>
                        .role-badge {
                            display: inline-block;
                            padding: 6px 12px;
                            color: white;
                            border-radius: 4px;
                            font-weight: bold;
                            text-transform: uppercase;
                            font-size: 0.8rem;
                            letter-spacing: 1px;
                            margin-top: 5px;
                            background-color: #777;
                        }
                        .admin-role {
                            background-color: #4a6da7;
                        }
                        .mentor-role {
                            background-color: #28a745;
                        }
                    </style>
                    <button id="back-btn">Back</button>
                `;

                document.getElementById("back-btn").addEventListener("click", renderAdminsAndMentors);
            }
        }

        async function removeAdminOrMentor(id) {
            try {
                // First get the user data from Firestore to have their email and other details
                const personRef = doc(db, 'adminsAndMentors', id);
                const personDoc = await getDoc(personRef);
                
                if (!personDoc.exists()) {
                    throw new Error("Person not found");
                }
                
                const personData = personDoc.data();
                
                // Delete from Firestore
                await deleteDoc(personRef);
                
                // Update local data
                adminsAndMentors = adminsAndMentors.filter(person => person.id !== id);
                
                try {
                    // Call the Cloud Function to delete the user from Authentication
                    const deleteUserAccount = httpsCallable(functions, 'deleteUserAccount');
                    const result = await deleteUserAccount({ userId: id });
                    
                    if (result.data.success) {
                        alert(`${personData.name} has been successfully removed from the system and their authentication account has been deleted.`);
                    } else {
                        alert(`${personData.name} has been removed from the database, but there was an issue deleting their authentication account: ${result.data.message}`);
                    }
                } catch (authError) {
                    console.error("Error deleting user from Authentication:", authError);
                    alert(
                        `${personData.name} has been removed from the system database.\n\n` +
                        `However, there was an error deleting the user from Authentication: ${authError.message}\n\n` +
                        `NOTE: To use this feature, you need to deploy the Firebase Cloud Function "deleteUserAccount".\n` +
                        `User ID to remove from Authentication: ${id}\n` +
                        `Email: ${personData.email}`
                    );
                }
                
                renderAdminsAndMentors();
            } catch (error) {
                console.error("Error removing person: ", error);
                alert("Failed to remove person: " + error.message);
            }
        }

        function renderAddMentorForm() {
            mainSection.innerHTML = `
                <h2>Add Team Member</h2>
                <form id="addMentorForm">
                    <label>Name: <input type="text" name="name" id="personName" required></label><br><br>
                    <label>Phone: <input type="text" name="phone" id="personPhone" maxlength="10" required></label><br><br>
                    <label>Email: <input type="email" name="email" id="personEmail" required></label><br><br>
                    <label>Designation: <input type="text" name="designation" id="designation" required></label><br><br>
                    <label>Role: 
                        <select name="role" id="personRole" required>
                            <option value="">-- Select Role --</option>
                            <option value="admin">admin</option>
                            <option value="mentor">mentor</option>
                        </select>
                    </label><br><br>
                    <button type="submit">Add Team Member</button><br><br>
                </form>
                <button id="backBtn">Back</button>
            `;

            document.getElementById("addMentorForm").addEventListener("submit", async (event) => {
                event.preventDefault();

                const name = document.getElementById("personName").value.trim();
                const phone = document.getElementById("personPhone").value.trim();
                const email = document.getElementById("personEmail").value.trim();
                const designation = document.getElementById("designation").value.trim();
                const role = document.getElementById("personRole").value.trim();

                // Generate automatic password
                const autoPassword = name.substring(0, 3).toLowerCase() + phone.substring(0, 5);

                try {
                    // Create user in Firebase Authentication
                    const userCredential = await createUserWithEmailAndPassword(auth, email, autoPassword);

                    // Add person details to Firestore
                    const personId = userCredential.user.uid;
                    await setDoc(doc(db, "adminsAndMentors", personId), {
                        name,
                        phone,
                        email,
                        designation,
                        role,
                        accepted: [],
                        password: autoPassword // Store the password if necessary
                    });

                    alert(`Team member added successfully! Auto-generated password: ${autoPassword}`);
                    loadAdminsAndMentors(); // Reload list
                } catch (error) {
                    console.error("Error adding team member: ", error);
                    alert("Error adding team member: " + error.message);
                }
            });

            document.getElementById("backBtn").addEventListener("click", renderAdminsAndMentors);
        }

        // Load startups
        async function loadStartups() {
            try {
                const startupsCollection = collection(db, 'startups');
                const snapshot = await getDocs(startupsCollection);
                startups = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderStartups();
            } catch (error) {
                console.error("Error loading startups: ", error);
            }
        }

        function renderStartups(filterLevel = null) {
            // Filter startups by selected level if a filter is applied
            const filteredStartups = filterLevel !== null 
                ? startups.filter(startup => startup.level === filterLevel)
                : startups;

            mainSection.innerHTML = `
                <h2>Startups</h2>
                <div class="startup-controls">
                    <div class="search-filter-container">
                        <div class="search-container">
                            <input type="text" id="startupSearchInput" placeholder="Search startups..." class="search-input">
                            <button id="startupSearchBtn" class="search-btn">Search</button>
                            <button id="clearStartupSearchBtn" class="clear-btn">Clear</button>
                        </div>
                        <div class="filter-container">
                            <label for="filterLevel">Filter by Level:</label>
                            <select id="filterLevel" class="filter-select">
                                <option value="">All Levels</option>
                                ${levels.map((level, index) => `
                                    <option value="${index}" ${filterLevel === index ? "selected" : ""}>${level}</option>
                                `).join("")}
                            </select>
                        </div>
                    </div>
                </div>
                <style>
                    .startup-controls {
                        margin-bottom: 1.5rem;
                    }
                    .search-filter-container {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        flex-wrap: wrap;
                        gap: 1rem;
                        margin-bottom: 1rem;
                    }
                    .search-container {
                        display: flex;
                        gap: 10px;
                        flex: 1;
                        max-width: 600px;
                    }
                    .search-input {
                        flex: 1;
                        padding: 10px 15px;
                        border: 1px solid #ddd;
                        border-radius: 5px;
                        font-size: 16px;
                        outline: none;
                        transition: border-color 0.3s;
                    }
                    .search-input:focus {
                        border-color: #5390bf;
                        box-shadow: 0 0 0 2px rgba(83, 144, 191, 0.2);
                    }
                    .search-btn {
                        padding: 10px 15px;
                        background-color: #5390bf;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: background-color 0.3s;
                    }
                    .search-btn:hover {
                        background-color: #4682B4;
                    }
                    .clear-btn {
                        padding: 10px 15px;
                        background-color: #f8f8f8;
                        color: #333;
                        border: 1px solid #ddd;
                        border-radius: 5px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: background-color 0.3s;
                    }
                    .clear-btn:hover {
                        background-color: #e0e0e0;
                    }
                    .filter-container {
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    }
                    .filter-select {
                        padding: 10px;
                        border: 1px solid #ddd;
                        border-radius: 5px;
                        font-size: 16px;
                        outline: none;
                        background-color: white;
                        cursor: pointer;
                    }
                    .filter-select:focus {
                        border-color: #5390bf;
                        box-shadow: 0 0 0 2px rgba(83, 144, 191, 0.2);
                    }
                    .no-results {
                        text-align: center;
                        padding: 2rem;
                        background: white;
                        border-radius: 10px;
                        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
                        color: #666;
                        font-size: 1.2rem;
                        margin: 20px 0;
                    }
                </style>
                <div id="startups-container" class="container">
                    ${filteredStartups.map(
                        startup => {
                            // Calculate growth percentage
                            const growthArray = startup.growth || [];
                            const totalGrowthPoints = growthArray.reduce((sum, point) => sum + (parseFloat(point) || 0), 0);
                            const maxPoints = 120; // Maximum possible points (12 criteria * 10 points each)
                            const percentage = (totalGrowthPoints / maxPoints) * 100;
                            
                            // Set progress bar color based on percentage
                            let progressColor = 'red';
                            if (percentage >= 70) {
                                progressColor = 'green';
                            } else if (percentage >= 50) {
                                progressColor = 'orange';
                            }
                            
                            return `
                            <div class="card startup-card">
                                <div class="startup-info">
                                    <h4>${startup.organizationName}</h4> 
                                    <p>Level: ${levels[startup.level || 0]}</p>
                                    <p>Registered: ${formatDate(startup.registrationDate)}</p>
                                    <div class="progress-container">
                                        <div class="progress-bar ${progressColor}" style="width: ${percentage}%">${percentage.toFixed(1)}%</div>
                                    </div>
                                    <div class="startup-actions">
                                        <button class="view-btn" data-id="${startup.id}">View</button>
                                        <button class="assign-level-btn" data-id="${startup.id}">Assign Level</button>
                                    </div>
                                </div>
                            </div>`
                        }
                    ).join("")}
                </div>
                <style>
                    .startup-card {
                        display: flex;
                        align-items: flex-start;
                        padding: 15px;
                        position: relative;
                    }
                    .startup-info {
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        text-align: center;
                        width: 100%;
                    }
                    .startup-info h4 {
                        margin-top: 5px;
                        margin-bottom: 10px;
                        font-size: 1.3rem;
                        color: #333;
                    }
                    .startup-info p {
                        margin: 5px 0;
                        color: #555;
                    }
                    .progress-container {
                        width: 100%;
                        margin: 12px 0;
                        height: 12px;
                        background-color: #f0f0f0;
                        border-radius: 6px;
                        overflow: hidden;
                    }
                    .progress-bar {
                        height: 100%;
                        text-align: center;
                        line-height: 12px;
                        font-size: 10px;
                        color: white;
                        transition: width 0.5s;
                    }
                    .startup-actions {
                        display: flex;
                        gap: 10px;
                        margin-top: 15px;
                    }
                </style>
            `;

            // Store all startups for filtering
            const allStartups = [...filteredStartups];
            
            // Function to filter startups based on search text
            function filterStartups(searchText) {
                if (!searchText.trim()) {
                    return allStartups;
                }
                
                const lowerSearchText = searchText.toLowerCase();
                return allStartups.filter(startup => 
                    (startup.organizationName && startup.organizationName.toLowerCase().includes(lowerSearchText)) || 
                    (startup.ownerName && startup.ownerName.toLowerCase().includes(lowerSearchText)) ||
                    (startup.email && startup.email.toLowerCase().includes(lowerSearchText))
                );
            }
            
            // Function to update the displayed startups
            function updateStartupsDisplay(filteredItems) {
                const startupsContainer = document.getElementById("startups-container");
                
                if (filteredItems.length === 0) {
                    startupsContainer.innerHTML = `<div class="no-results">No startups found matching your search criteria.</div>`;
                    return;
                }
                
                startupsContainer.innerHTML = filteredItems.map(startup => {
                    // Calculate growth percentage
                    const growthArray = startup.growth || [];
                    const totalGrowthPoints = growthArray.reduce((sum, point) => sum + (parseFloat(point) || 0), 0);
                    const maxPoints = 120; // Maximum possible points (12 criteria * 10 points each)
                    const percentage = (totalGrowthPoints / maxPoints) * 100;
                    
                    // Set progress bar color based on percentage
                    let progressColor = 'red';
                    if (percentage >= 70) {
                        progressColor = 'green';
                    } else if (percentage >= 50) {
                        progressColor = 'orange';
                    }
                    
                    return `
                    <div class="card startup-card">
                        <div class="startup-info">
                            <h4>${startup.organizationName}</h4> 
                            <p>Level: ${levels[startup.level || 0]}</p>
                            <p>Registered: ${formatDate(startup.registrationDate)}</p>
                            <div class="progress-container">
                                <div class="progress-bar ${progressColor}" style="width: ${percentage}%">${percentage.toFixed(1)}%</div>
                            </div>
                            <div class="startup-actions">
                                <button class="view-btn" data-id="${startup.id}">View</button>
                                <button class="assign-level-btn" data-id="${startup.id}">Assign Level</button>
                            </div>
                        </div>
                    </div>`;
                }).join("");
                
                // Reattach event listeners
                attachEventListeners();
            }
            
            // Function to attach event listeners to startup action buttons
            function attachEventListeners() {
                document.querySelectorAll(".view-btn").forEach(button => {
                    button.addEventListener("click", event => {
                        const startupId = event.target.getAttribute("data-id");
                        viewStartupDetails(startupId);
                    });
                });

                document.querySelectorAll(".assign-level-btn").forEach(button => {
                    button.addEventListener("click", event => {
                        const startupId = event.target.getAttribute("data-id");
                        renderAssignLevelForm(startupId);
                    });
                });
            }
            
            // Search button click event
            document.getElementById("startupSearchBtn").addEventListener("click", () => {
                const searchText = document.getElementById("startupSearchInput").value;
                const filteredItems = filterStartups(searchText);
                updateStartupsDisplay(filteredItems);
            });
            
            // Clear search button click event
            document.getElementById("clearStartupSearchBtn").addEventListener("click", () => {
                document.getElementById("startupSearchInput").value = "";
                updateStartupsDisplay(allStartups);
            });
            
            // Search input enter key event
            document.getElementById("startupSearchInput").addEventListener("keyup", (event) => {
                if (event.key === "Enter") {
                    const searchText = event.target.value;
                    const filteredItems = filterStartups(searchText);
                    updateStartupsDisplay(filteredItems);
                }
            });
            
            // Event listener for level filter
            document.getElementById("filterLevel").addEventListener("change", event => {
                const selectedLevel = event.target.value === "" ? null : parseInt(event.target.value);
                renderStartups(selectedLevel);
            });
            
            // Initial attachment of event listeners
            attachEventListeners();
        }

        function viewStartupDetails(id) {
            const startup = startups.find((s) => s.id === id);
            if (startup) {
                mainSection.innerHTML = `
                    <div class="startup-detail-container">
                        <!-- Header Section -->
                        <div class="card">
                            <div class="startup-header">
                                <div class="startup-title">
                                    <h2>${startup.organizationName}</h2>
                                    <span class="level-badge">${levels[startup.level || 0]}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profile Information Section -->
                        <div class="cards-row">
                            <div class="card details-card" style="flex: 1;">
                                <h3>Company Details</h3>
                                <div class="profile-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Registration Date:</span>
                                        <span class="detail-value">${formatDate(startup.registrationDate)}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Contact Info:</span>
                                        <span class="detail-value">${startup.phoneNumber} | ${startup.email}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Documents:</span>
                                        <span class="detail-value">
                                            <a href="${startup.driveLink}" target="_blank" class="document-link">
                                                <i class="document-icon"></i> View Documents
                                            </a>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Growth Assessment Section -->
                        <div class="card growth-section">
                            <h3>Growth Assessment</h3>
                            <p class="section-description">Rate the startup from 0-10 on each growth dimension</p>
                            
                            <form id="growthForm">
                                <div class="growth-points-grid">
                                    ${growthPoints.map((point, index) => {
                                        const value = startup.growth?.[index] || 0;
                                        const colorClass = value >= 7 ? 'high-score' : value >= 4 ? 'medium-score' : 'low-score';
                                        
                                        return `
                                        <div class="growth-point-card ${colorClass}">
                                            <label class="growth-label">
                                                <span class="growth-title">${point}</span>
                                                <div class="score-input-container">
                                                    <input type="number" min="0" max="10" name="growth-${index}" 
                                                        value="${value}" class="score-input">
                                                    <span class="score-display">${value}/10</span>
                                                </div>
                                            </label>
                                        </div>
                                        `;
                                    }).join("")}
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="primary-btn">Update Growth Assessment</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <style>
                        .startup-detail-container {
                            display: flex;
                            flex-direction: column;
                            gap: 24px;
                            margin-bottom: 30px;
                        }
                        .startup-header {
                            display: flex;
                            align-items: center;
                            padding: 20px;
                        }
                        .startup-title {
                            display: flex;
                            flex-direction: column;
                        }
                        .level-badge {
                            display: inline-block;
                            background-color: #5390bf;
                            color: white;
                            padding: 4px 10px;
                            border-radius: 4px;
                            font-size: 0.8rem;
                            margin-top: 5px;
                        }
                        .startup-header h2 {
                            margin: 0;
                            font-size: 2rem;
                            color: #333;
                        }
                        .cards-row {
                            display: flex;
                            gap: 24px;
                        }
                        .details-card {
                            flex: 0 0 70%;
                            padding: 24px;
                        }
                        .profile-details {
                            display: flex;
                            flex-direction: column;
                            padding: 15px 0;
                        }
                        .detail-row {
                            display: flex;
                            margin-bottom: 16px;
                            padding-bottom: 8px;
                            border-bottom: 1px solid #eee;
                        }
                        .detail-label {
                            font-weight: 600;
                            width: 150px;
                            color: #555;
                        }
                        .detail-value {
                            flex: 1;
                        }
                        .document-link {
                            color: #5390bf;
                            text-decoration: none;
                            display: inline-flex;
                            align-items: center;
                        }
                        .document-link:hover {
                            text-decoration: underline;
                        }
                        .section-description {
                            color: #666;
                            margin-bottom: 20px;
                        }
                        .growth-section {
                            padding: 24px;
                            width: 100%;
                            max-width: 100%;
                        }
                        .growth-points-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                            gap: 20px;
                            margin-bottom: 24px;
                            width: 100%;
                        }
                        .growth-point-card {
                            padding: 16px;
                            border-radius: 8px;
                            background-color: #f9f9f9;
                            border-left: 5px solid #ddd;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                            transition: all 0.3s ease;
                            display: flex;
                            flex-direction: column;
                            height: 100%;
                            width: 100%;
                            min-width: 100%;
                            box-sizing: border-box;
                        }
                        .growth-point-card:hover {
                            transform: translateY(-3px);
                            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
                        }
                        .growth-point-card.high-score {
                            border-left-color: #28a745;
                            background-color: rgba(40, 167, 69, 0.05);
                        }
                        .growth-point-card.medium-score {
                            border-left-color: #ffc107;
                            background-color: rgba(255, 193, 7, 0.05);
                        }
                        .growth-point-card.low-score {
                            border-left-color: #dc3545;
                            background-color: rgba(220, 53, 69, 0.05);
                        }
                        .growth-label {
                            display: flex;
                            flex-direction: column;
                            width: 100%;
                            cursor: pointer;
                        }
                        .growth-title {
                            margin-bottom: 15px;
                            font-weight: 500;
                            line-height: 1.4;
                            font-size: 0.95rem;
                        }
                        .score-input-container {
                            display: flex;
                            align-items: center;
                            margin-top: auto;
                        }
                        .score-input {
                            width: 60px;
                            padding: 8px;
                            border: 1px solid #ddd;
                            border-radius: 4px;
                            margin-right: 10px;
                            text-align: center;
                            font-weight: 500;
                        }
                        .score-input:focus {
                            outline: none;
                            border-color: #5390bf;
                            box-shadow: 0 0 0 2px rgba(83, 144, 191, 0.2);
                        }
                        .score-display {
                            font-weight: 600;
                            color: #444;
                            min-width: 40px;
                        }
                        .high-score .score-display {
                            color: #28a745;
                        }
                        .medium-score .score-display {
                            color: #d97706;
                        }
                        .low-score .score-display {
                            color: #dc3545;
                        }
                        .form-actions {
                            display: flex;
                            justify-content: center;
                            margin-top: 20px;
                        }
                        .primary-btn {
                            background-color: #5390bf;
                            color: white;
                            border: none;
                            border-radius: 5px;
                            font-weight: 600;
                            font-size: 1rem;
                            cursor: pointer;
                            transition: background-color 0.3s, transform 0.2s;
                        }
                        .primary-btn:hover {
                            background-color: #4682B4;
                            transform: translateY(-2px);
                        }
                        .secondary-btn {
                            background-color: #f0f0f0;
                            color: #333;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 5px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: background-color 0.3s;
                        }
                        .secondary-btn:hover {
                            background-color: #e0e0e0;
                        }
                        .action-buttons {
                            display: flex;
                            gap: 15px;
                            margin-top: 10px;
                            justify-content: center;
                        }
                        
                        @media (max-width: 768px) {
                            .cards-row {
                                flex-direction: column;
                            }
                            .photo-card, .details-card {
                                width: 100%;
                            }
                            .growth-points-grid {
                                grid-template-columns: 1fr;
                            }
                        }
                    </style>
                    
                    <div class="action-buttons">
                        <button id="back-btn" class="secondary-btn">Back to Startups</button>
                        <button id="assign-level-btn" class="primary-btn" data-id="${startup.id}">Reassign Level</button>
                    </div>
                `;

                document.getElementById("back-btn").addEventListener("click", renderStartups);
                document.getElementById("assign-level-btn").addEventListener("click", () => {
                    renderAssignLevelForm(id);
                });
                
                document.getElementById("growthForm").addEventListener("submit", (event) => {
                    event.preventDefault();
                    updateGrowthData(id, new FormData(event.target));
                });
            }
        }

        function renderAssignLevelForm(startupId) {
            const startup = startups.find(s => s.id === startupId);
            if (startup) {
                mainSection.innerHTML = `
                    <h2>Assign Level to ${startup.organizationName}</h2>
                    <form id="assignLevelForm">
                        <label for="levelSelect">Select Level:</label>
                        <select id="levelSelect">
                            ${levels.map((level, index) => `
                                <option value="${index}" ${startup.level === index ? "selected" : ""}>${level}</option>
                            `).join("")}
                        </select><br><br>
                        <button type="submit">Update Level</button><br><br>
                    </form>
                    <button id="back-btn">Back</button>
                `;

                document.getElementById("assignLevelForm").addEventListener("submit", event => {
                    event.preventDefault();
                    const selectedLevel = parseInt(document.getElementById("levelSelect").value);
                    updateStartupLevel(startupId, selectedLevel);
                });

                document.getElementById("back-btn").addEventListener("click", renderStartups);
            }
        }

        async function updateStartupLevel(startupId, level) {
            try {
                const startupRef = doc(db, 'startups', startupId);
                await updateDoc(startupRef, { level });
                alert("Level updated successfully!");
                loadStartups();
            } catch (error) {
                console.error("Error updating startup level: ", error);
                alert("Failed to update level.");
            }
        }

        async function updateGrowthData(id, formData) {
            try {
                const growthData = growthPoints.map((_, index) => parseFloat(formData.get(`growth-${index}`)) || 0);
                const startupRef = doc(db, 'startups', id);
                await updateDoc(startupRef, { growth: growthData });
                alert("Growth data updated successfully!");
                renderStartups();
            } catch (error) {
                console.error("Error updating growth data: ", error);
                alert("Failed to update growth data.");
            }
        }

        document.getElementById("logoutBtn").addEventListener("click", async () => {
            try {
                await signOut(auth);
                alert("Logged out successfully!");
                window.location.href = "login.html"; // Redirect to login page after logout
            } catch (error) {
                console.error("Logout failed: ", error);
                alert("Failed to log out. Please try again.");
            }
        });


        async function loadBlogs() {
            const blogsCollection = collection(db, 'blogs');
            const snapshot = await getDocs(blogsCollection);
            const blogs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderBlogs(blogs);
        }

        function renderBlogs(blogs) {
            const mainSection = document.getElementById("mainSection");
            mainSection.innerHTML = `
                <h2>Blogs</h2>
                <div class="blog-controls">
                    <div class="search-container">
                        <input type="text" id="blogSearchInput" placeholder="Search blogs..." class="search-input">
                        <button id="searchBtn" class="search-btn">Search</button>
                        <button id="clearSearchBtn" class="clear-btn">Clear</button>
                    </div>
                    <button id="addBlogBtn" class="add-blog-btn">Add Blog</button>
                </div>
                <style>
                    .blog-controls {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 1.5rem;
                        flex-wrap: wrap;
                        gap: 1rem;
                    }
                    .search-container {
                        display: flex;
                        gap: 10px;
                        flex: 1;
                        max-width: 600px;
                    }
                    .search-input {
                        flex: 1;
                        padding: 10px 15px;
                        border: 1px solid #ddd;
                        border-radius: 5px;
                        font-size: 16px;
                        outline: none;
                        transition: border-color 0.3s;
                    }
                    .search-input:focus {
                        border-color: #5390bf;
                        box-shadow: 0 0 0 2px rgba(83, 144, 191, 0.2);
                    }
                    .search-btn {
                        padding: 10px 15px;
                        background-color: #5390bf;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: background-color 0.3s;
                    }
                    .search-btn:hover {
                        background-color: #4682B4;
                    }
                    .clear-btn {
                        padding: 10px 15px;
                        background-color: #f8f8f8;
                        color: #333;
                        border: 1px solid #ddd;
                        border-radius: 5px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: background-color 0.3s;
                    }
                    .clear-btn:hover {
                        background-color: #e0e0e0;
                    }
                    .add-blog-btn {
                        padding: 10px 20px;
                        background-color: #5390bf;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: background-color 0.3s;
                    }
                    .add-blog-btn:hover {
                        background-color: #4682B4;
                    }
                    .blogs-container {
                        display: flex;
                        flex-direction: column;
                        gap: 2rem;
                    }
                    .blog-item {
                        margin-bottom: 1rem;
                        background: white;
                        border-radius: 10px;
                        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
                        overflow: hidden;
                        transition: transform 0.3s ease;
                    }
                    .blog-item:hover {
                        transform: translateY(-5px);
                    }
                    .blog-preview {
                        padding: 2rem;
                    }
                    .blog-preview h3 {
                        color: #333;
                        font-size: 1.8rem;
                        margin-bottom: 1rem;
                    }
                    .blog-date {
                        color: #666;
                        font-size: 1rem;
                        margin-bottom: 1rem;
                    }
                    .blog-subtitle {
                        color: #555;
                        font-size: 1.1rem;
                        line-height: 1.6;
                        margin-bottom: 1.5rem;
                    }
                    .blog-actions {
                        display: flex;
                        gap: 10px;
                        padding: 1rem 2rem;
                        background: #f8f8f8;
                    }
                    .blog-btn {
                        padding: 0.8rem 1.5rem;
                        background-color: #5390bf;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 1rem;
                        font-weight: 600;
                        transition: background-color 0.3s;
                    }
                    .blog-btn:hover {
                        background-color: #4682B4;
                    }
                    .view-blog {
                        background-color: #5390bf;
                    }
                    .edit-blog {
                        background-color: #f0ad4e;
                    }
                    .delete-blog {
                        background-color: #d9534f;
                    }
                    .no-results {
                        text-align: center;
                        padding: 2rem;
                        background: white;
                        border-radius: 10px;
                        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
                        color: #666;
                        font-size: 1.2rem;
                    }
                </style>
                <div id="blogs-container" class="blogs-container">
                    ${blogs.map(blog => `
                        <div class="blog-item">
                            <div class="blog-preview">
                                <h3>${blog.title}</h3>
                                <p class="blog-date"><strong>${blog.date}</strong></p>
                                <p class="blog-subtitle">${blog.subtitle}</p>
                            </div>
                            <div class="blog-actions">
                                <button class="blog-btn view-blog" data-id="${blog.id}">View</button>
                                <button class="blog-btn edit-blog" data-id="${blog.id}">Edit</button>
                                <button class="blog-btn delete-blog" data-id="${blog.id}">Delete</button>
                            </div>
                        </div>
                    `).join("")}
                </div>
            `;

            // Store all blogs in a variable for filtering
            const allBlogs = [...blogs];

            // Function to filter blogs based on search text
            function filterBlogs(searchText) {
                if (!searchText.trim()) {
                    return allBlogs;
                }
                
                const lowerSearchText = searchText.toLowerCase();
                return allBlogs.filter(blog => 
                    blog.title.toLowerCase().includes(lowerSearchText) || 
                    blog.subtitle.toLowerCase().includes(lowerSearchText) ||
                    blog.content.toLowerCase().includes(lowerSearchText)
                );
            }

            // Function to update the displayed blogs
            function updateBlogDisplay(filteredBlogs) {
                const blogsContainer = document.getElementById("blogs-container");
                
                if (filteredBlogs.length === 0) {
                    blogsContainer.innerHTML = `<div class="no-results">No blogs found matching your search criteria.</div>`;
                    return;
                }
                
                blogsContainer.innerHTML = filteredBlogs.map(blog => `
                    <div class="blog-item">
                        <div class="blog-preview">
                            <h3>${blog.title}</h3>
                            <p class="blog-date"><strong>${blog.date}</strong></p>
                            <p class="blog-subtitle">${blog.subtitle}</p>
                        </div>
                        <div class="blog-actions">
                            <button class="blog-btn view-blog" data-id="${blog.id}">View</button>
                            <button class="blog-btn edit-blog" data-id="${blog.id}">Edit</button>
                            <button class="blog-btn delete-blog" data-id="${blog.id}">Delete</button>
                        </div>
                    </div>
                `).join("");
                
                // Reattach event listeners
                attachEventListeners();
            }

            // Function to attach event listeners to blog action buttons
            function attachEventListeners() {
                document.querySelectorAll(".view-blog").forEach(button => {
                    button.addEventListener("click", event => {
                        const blogId = event.target.dataset.id;
                        const blog = allBlogs.find(b => b.id === blogId);
                        openLightbox(blog);
                    });
                });

                document.querySelectorAll(".edit-blog").forEach(button => {
                    button.addEventListener("click", event => {
                        const blogId = event.target.dataset.id;
                        const blog = allBlogs.find(b => b.id === blogId);
                        renderEditBlogForm(blog);
                    });
                });

                document.querySelectorAll(".delete-blog").forEach(button => {
                    button.addEventListener("click", async event => {
                        if (confirm("Are you sure you want to delete this blog?")) {
                            const blogId = event.target.dataset.id;
                            await deleteDoc(doc(db, "blogs", blogId));
                            loadBlogs();
                        }
                    });
                });
            }

            // Search button click event
            document.getElementById("searchBtn").addEventListener("click", () => {
                const searchText = document.getElementById("blogSearchInput").value;
                const filteredBlogs = filterBlogs(searchText);
                updateBlogDisplay(filteredBlogs);
            });

            // Clear search button click event
            document.getElementById("clearSearchBtn").addEventListener("click", () => {
                document.getElementById("blogSearchInput").value = "";
                updateBlogDisplay(allBlogs);
            });

            // Search input enter key event
            document.getElementById("blogSearchInput").addEventListener("keyup", (event) => {
                if (event.key === "Enter") {
                    const searchText = event.target.value;
                    const filteredBlogs = filterBlogs(searchText);
                    updateBlogDisplay(filteredBlogs);
                }
            });

            // Initial attachment of event listeners
            attachEventListeners();

            document.getElementById("addBlogBtn").addEventListener("click", renderAddBlogForm);
        }

        function openLightbox(blog) {
            const lightbox = document.createElement("div");
            lightbox.classList.add("lightbox");
            lightbox.innerHTML = `
                <style>
                    .lightbox {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background-color: rgba(0, 0, 0, 0.7);
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        z-index: 1000;
                    }
                    .lightbox-content {
                        background-color: white;
                        padding: 2rem;
                        border-radius: 10px;
                        width: 80%;
                        max-width: 800px;
                        max-height: 90vh;
                        overflow-y: auto;
                        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                    }
                    .lightbox-header {
                        text-align: center;
                        margin-bottom: 2rem;
                        padding-bottom: 2rem;
                        border-bottom: 2px solid #eee;
                    }
                    .lightbox-header h2 {
                        color: #5390bf;
                        font-size: 2.5rem;
                        margin-bottom: 1rem;
                    }
                    .blog-subtitle {
                        font-size: 1.2rem;
                        color: #555;
                        margin-bottom: 0.5rem;
                    }
                    .blog-date {
                        font-size: 1rem;
                        color: #666;
                    }
                    .lightbox-body {
                        font-size: 1.1rem;
                        line-height: 1.8;
                        color: #333;
                        margin-bottom: 2rem;
                    }
                    .view-button {
                        display: block;
                        margin: 2rem auto 0;
                        max-width: 200px;
                        text-align: center;
                        padding: 0.8rem 1.5rem;
                        background-color: #5390bf;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 1rem;
                        font-weight: 600;
                        transition: background-color 0.3s;
                    }
                    .view-button:hover {
                        background-color: #4682B4;
                    }
                </style>
                <div class="lightbox-content">
                    <div class="lightbox-header">
                        <h2>${blog.title}</h2>
                        <p class="blog-subtitle">${blog.subtitle}</p>
                        <p class="blog-date"><strong>${blog.date}</strong></p>
                    </div>
                    <div class="lightbox-body">
                        ${blog.content}
                    </div>
                    <button id="closeLightbox" class="view-button">Close</button>
                </div>
            `;
            document.body.appendChild(lightbox);
            document.getElementById("closeLightbox").addEventListener("click", () => {
                document.body.removeChild(lightbox);
            });
            
            // Close lightbox when clicking outside the content
            lightbox.addEventListener("click", (e) => {
                if (e.target === lightbox) {
                    document.body.removeChild(lightbox);
                }
            });
        }

        function renderAddBlogForm() {
            document.getElementById("mainSection").innerHTML = `
                <h2>Add Blog</h2>
                <form id="blogForm">
                    <label>Title: <input type="text" id="blogTitle" required class="form-input"></label><br><br>
                    <label>Subtitle: <input type="text" id="blogSubtitle" required class="form-input"></label><br><br>
                    <label>Date: <input type="date" id="blogDate" required class="form-input"></label><br><br>
                    <label>Content:</label><br><br>
                    <div id="toolbar" class="editor-toolbar">
                        <button type="button" onclick="formatText('bold')" class="toolbar-btn">Bold</button>
                        <button type="button" onclick="formatText('italic')" class="toolbar-btn">Italic</button>
                        <button type="button" onclick="formatText('underline')" class="toolbar-btn">Underline</button>
                        <button type="button" onclick="formatText('strikeThrough')" class="toolbar-btn">Strike</button>
                        <button type="button" onclick="formatText('justifyLeft')" class="toolbar-btn">Left</button>
                        <button type="button" onclick="formatText('justifyCenter')" class="toolbar-btn">Center</button>
                        <button type="button" onclick="formatText('justifyRight')" class="toolbar-btn">Right</button>
                        <button type="button" onclick="formatText('insertOrderedList')" class="toolbar-btn">Numbered List</button>
                        <button type="button" onclick="formatText('insertUnorderedList')" class="toolbar-btn">Bullet List</button>
                    </div><br>
                    <div id="blogContent" contenteditable="true" class="content-box"></div><br>
                    <div class="form-actions">
                        <button type="submit" class="submit-btn">Add Blog</button>
                        <button type="button" id="cancelBtn" class="cancel-btn">Cancel</button>
                    </div>
                </form>
                <style>
                    .form-input {
                        width: 100%;
                        padding: 10px;
                        border: 1px solid #ddd;
                        border-radius: 5px;
                        font-size: 16px;
                        margin-top: 5px;
                    }
                    .editor-toolbar {
                        display: flex;
                        flex-wrap: wrap;
                        gap: 5px;
                        padding: 10px;
                        background-color: #f5f5f5;
                        border-radius: 5px 5px 0 0;
                        border: 1px solid #ddd;
                    }
                    .toolbar-btn {
                        padding: 8px 12px;
                        background-color: #fff;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    .toolbar-btn:hover {
                        background-color: #5390bf;
                        color: white;
                    }
                    .content-box {
                        width: 100%;
                        min-height: 300px;
                        padding: 15px;
                        border: 1px solid #ddd;
                        border-top: none;
                        border-radius: 0 0 5px 5px;
                        font-size: 16px;
                        line-height: 1.6;
                        overflow-y: auto;
                    }
                    .form-actions {
                        display: flex;
                        gap: 10px;
                        margin-top: 15px;
                    }
                    .submit-btn {
                        padding: 10px 20px;
                        background-color: #5390bf;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 16px;
                        font-weight: 600;
                    }
                    .submit-btn:hover {
                        background-color: #4682B4;
                    }
                    .cancel-btn {
                        padding: 10px 20px;
                        background-color: #f8f8f8;
                        color: #333;
                        border: 1px solid #ddd;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 16px;
                        font-weight: 600;
                    }
                    .cancel-btn:hover {
                        background-color: #e0e0e0;
                    }
                </style>
            `;

            document.getElementById("blogForm").addEventListener("submit", async event => {
                event.preventDefault();
                const title = document.getElementById("blogTitle").value;
                const subtitle = document.getElementById("blogSubtitle").value;
                const date = document.getElementById("blogDate").value;
                const content = document.getElementById("blogContent").innerHTML;
                await addDoc(collection(db, "blogs"), { title, subtitle, date, content });
                loadBlogs();
            });

            document.getElementById("cancelBtn").addEventListener("click", loadBlogs);
        }
    
        window.formatText = function(command) {
            document.execCommand(command, false, null);
        };

        function renderEditBlogForm(blog) {
            document.getElementById("mainSection").innerHTML = `
                <h2>Edit Blog</h2>
                <form id="editBlogForm">
                    <label>Title: <input type="text" id="blogTitle" value="${blog.title}" required class="form-input"></label><br><br>
                    <label>Subtitle: <input type="text" id="blogSubtitle" value="${blog.subtitle}" required class="form-input"></label><br><br>
                    <label>Date: <input type="date" id="blogDate" value="${blog.date}" required class="form-input"></label><br><br>
                    <label>Content:</label><br><br>
                    <div id="toolbar" class="editor-toolbar">
                        <button type="button" onclick="formatText('bold')" class="toolbar-btn">Bold</button>
                        <button type="button" onclick="formatText('italic')" class="toolbar-btn">Italic</button>
                        <button type="button" onclick="formatText('underline')" class="toolbar-btn">Underline</button>
                        <button type="button" onclick="formatText('strikeThrough')" class="toolbar-btn">Strike</button>
                        <button type="button" onclick="formatText('justifyLeft')" class="toolbar-btn">Left</button>
                        <button type="button" onclick="formatText('justifyCenter')" class="toolbar-btn">Center</button>
                        <button type="button" onclick="formatText('justifyRight')" class="toolbar-btn">Right</button>
                        <button type="button" onclick="formatText('insertOrderedList')" class="toolbar-btn">Numbered List</button>
                        <button type="button" onclick="formatText('insertUnorderedList')" class="toolbar-btn">Bullet List</button>
                    </div><br>
                    <div id="blogContent" contenteditable="true" class="content-box">${blog.content}</div><br>
                    <div class="form-actions">
                        <button type="submit" class="submit-btn">Update Blog</button>
                        <button type="button" id="cancelBtn" class="cancel-btn">Cancel</button>
                    </div>
                </form>
                <style>
                    .form-input {
                        width: 100%;
                        padding: 10px;
                        border: 1px solid #ddd;
                        border-radius: 5px;
                        font-size: 16px;
                        margin-top: 5px;
                    }
                    .editor-toolbar {
                        display: flex;
                        flex-wrap: wrap;
                        gap: 5px;
                        padding: 10px;
                        background-color: #f5f5f5;
                        border-radius: 5px 5px 0 0;
                        border: 1px solid #ddd;
                    }
                    .toolbar-btn {
                        padding: 8px 12px;
                        background-color: #fff;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    .toolbar-btn:hover {
                        background-color: #5390bf;
                        color: white;
                    }
                    .content-box {
                        width: 100%;
                        min-height: 300px;
                        padding: 15px;
                        border: 1px solid #ddd;
                        border-top: none;
                        border-radius: 0 0 5px 5px;
                        font-size: 16px;
                        line-height: 1.6;
                        overflow-y: auto;
                    }
                    .form-actions {
                        display: flex;
                        gap: 10px;
                        margin-top: 15px;
                    }
                    .submit-btn {
                        padding: 10px 20px;
                        background-color: #5390bf;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 16px;
                        font-weight: 600;
                    }
                    .submit-btn:hover {
                        background-color: #4682B4;
                    }
                    .cancel-btn {
                        padding: 10px 20px;
                        background-color: #f8f8f8;
                        color: #333;
                        border: 1px solid #ddd;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 16px;
                        font-weight: 600;
                    }
                    .cancel-btn:hover {
                        background-color: #e0e0e0;
                    }
                </style>
            `;

            document.getElementById("editBlogForm").addEventListener("submit", async event => {
                event.preventDefault();
                const title = document.getElementById("blogTitle").value;
                const subtitle = document.getElementById("blogSubtitle").value;
                const date = document.getElementById("blogDate").value;
                const content = document.getElementById("blogContent").innerHTML;
                
                try {
                    await updateDoc(doc(db, "blogs", blog.id), { 
                        title, 
                        subtitle, 
                        date, 
                        content 
                    });
                    alert("Blog updated successfully!");
                    loadBlogs();
                } catch (error) {
                    console.error("Error updating blog: ", error);
                    alert("Failed to update blog.");
                }
            });

            document.getElementById("cancelBtn").addEventListener("click", loadBlogs);
        }

        // Switch event listeners
        document.getElementById("mentorsSwitch").addEventListener("click", () => {
            clearActiveButtons();
            document.getElementById("mentorsSwitch").classList.add("active");
            loadAdminsAndMentors();
        });
        document.getElementById("startupsSwitch").addEventListener("click", () => {
            clearActiveButtons();
            document.getElementById("startupsSwitch").classList.add("active");
            loadStartups();
        });
        document.getElementById("blogsSwitch").addEventListener("click", () => {
            clearActiveButtons();
            document.getElementById("blogsSwitch").classList.add("active");
            loadBlogs();
        });

        // Function to clear active class from all buttons
        function clearActiveButtons() {
            document.querySelectorAll(".switches-container button").forEach(button => {
                button.classList.remove("active");
            });
        }

        // Initial load
        clearActiveButtons();
        document.getElementById("startupsSwitch").classList.add("active");
        loadStartups();
    </script>
</head>
<body>
    <nav>
        <h1>ERP - Admin Dashboard</h1>
        <button id="logoutBtn">Logout</button>
    </nav>
    <div class="switches-container">
        <button id="mentorsSwitch">Admins and Mentors</button>
        <button id="startupsSwitch">Startups</button>
        <button id="blogsSwitch">Blogs</button>        
    </div>
    <div class="main-section" id="mainSection">
        <!-- Dynamic content will be rendered here -->
    </div>
</body>
</html>
